<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .calendar{
            display: inline-block;
            /* width: 220px; */
            border: 1px solid #aa2;
            text-align: center;
            font-size: 0;
        }
        .calendar .header{
            font-size: 15px;
        }
        .week{
            display: inline-block;
            width: 14%;
            height: 25px;
            background-color: #aa2; 
            font-size: 18px;
            
        }
        .day.other{
            font-weight: 300;
            font-size: 8px;
            color: #999;
        }
        .day{
            display: inline-block;
            box-sizing: border-box;
            width: 14%;
            height: 20px;
            vertical-align: middle;
            line-height: 20px;
            font-weight: 700;
            font-size: 15px;
        }
    </style>
</head>
<body>
    <div class="calendar">
        <div class="header">
            <input type="submit" value="<" onclick="app.lastMonth()">
            <span class="year">2020</span>
            <span>年</span>
            <span class="month">4</span>
            <span>月</span>
            <input type="submit" value=">" onclick="app.nextMonth()">
            <input type="submit" value="now" onclick="app.nowTime()">
        </div>
        <div class="week-wrap">
            <div class="week">日</div>
            <div class="week">一</div>
            <div class="week">二</div>
            <div class="week">三</div>
            <div class="week">四</div>
            <div class="week">五</div>
            <div class="week">六</div>
        </div>
        <div class="day-wrap">

        </div>
    </div>


    <script>
        var app = {
            dayWrap: document.querySelector('.day-wrap'),
            viewYear: document.querySelector('.year'),
            viewMonth: document.querySelector('.month'),
            currentYear: new Date().getFullYear(),
            currentMonth: new Date().getMonth()+1,
            currentDate: new Date().getDate(),
            
            a: this,
            currentW: new Date().getDay(),
            newYear: new Date().getFullYear(),
            newMonth: new Date().getMonth()+1,
            month: [// 默认2月有28天
                31,28,31,30,
                31,30,31,31,
                30,31,30,31
            ],
            date: [],
            getDate: function(year,month){
                let week = this.weekOfFirstDay(year,month);
                this.month[1] = this.isLeapMonth(year);
                let preMonth = month == 1? 12: month-1;
                for(let i=0;i<42;i++){
                    if(i<week){
                        this.date[i] = this.month[preMonth-1]-week+i+1;
                    }else if(i<week+this.month[month-1]){
                        this.date[i] = i-week+1+0.3;
                    }else{
                        this.date[i] = i-(week+this.month[month-1])+1;
                    }
                    
                }
            },
            init: function(){
                console.log(this)
                this.getDate(this.newYear,this.newMonth);
                if(this.dayWrap.children[0]){
                    for(let i=0;i<42;i++){
                        this.dayWrap.children[i].innerHTML = Math.floor(this.date[i]);
                        if(!(this.date[i]%1)){
                            this.dayWrap.children[i].classList.add('other');
                        }else{
                            this.dayWrap.children[i].classList.remove('other');
                        }
                    }
                }else{
                    for(let i=0;i<42;i++){
                        this.dayWrap.innerHTML+= `<div class="day">${Math.floor(this.date[i])}</div>`;
                        if(!(this.date[i]%1)){
                            this.dayWrap.children[i].classList.add('other');
                        }else{
                            this.dayWrap.children[i].classList.remove('other');
                        }
                    }
                }
                this.DetailDay();
                this.viewYear.innerHTML = this.newYear;
                this.viewMonth.innerHTML = this.newMonth;
            },
            DetailDay: function(){
                let week = this.weekOfFirstDay(this.currentYear,this.currentMonth);
                if(this.newYear==this.currentYear&&this.newMonth==this.currentMonth){
                    this.dayWrap.children[week+this.currentDate-1].style.border = '1px solid #aa2';
                }else{
                    this.dayWrap.children[week+this.currentDate-1].style.border = 'none';
                }
            },
            isLeapYear: (year)=>{
                if(year%400) return true;
                if(year%100) return false;
                if(year%4) return true;
                return false;
            },
            isLeapMonth: function(year){
                return this.isLeapYear(year)? 29: 28;
            },
            weekOfFirstDay: (year,month)=>{
                return new Date(`${year}/${month}/1`).getDay()
            },
            lastMonth: function(){
                this.newMonth--;
                if(this.newMonth==0){
                    this.newYear--;
                    this.newMonth=12;
                    
                }
                this.init();
            },
            nextMonth: function(){
                this.newMonth++;
                if(this.newMonth==13){
                    this.newYear++;
                    this.newMonth=1;
                }
                this.init();
            },
            nowTime: function(){
                this.newYear = this.currentYear;
                this.newMonth = this.currentMonth;
                this.init();
            }
        }

/* 
初始化
五行7列
判断该月有几天
        月份数组
        月份[1](2月有几天)
该月的上一个月有几天
        该月的第一天的星期0-6决定上个月有几天会显示


*/
        app.init();
        // console.log(app.today)
        // console.log(app.currentDate)
        // console.log(app.currentYear)
        // console.log(app.currentW)
        // console.log(app.currentMonth)
        // console.log(app.newYear)
        // // console.log(app.isLeapMonth())
        // console.log(new Date(`${app.currentYear}/${app.currentMonth}/1`).getDay())
        


        // name = 'global';
    
        // var hello = function(){
        //     console.log(this.name);
        // };
        // var he = hello();
        // var h = hello.bind();
        // h(); // out 'global';


        // h = (i)=>{
        //     return (j)=>{
        //         return (k)=>{
        //             return i+j+k;
        //         }
        //     }
        // }    
        // // console.log(h(1)(2)(3));
        // dd = (i)=>{
        //     let w = 2;
        //     return (j)=>{
        //         return j*w++;
        //     }
        // }    
        // s = dd(1);
        // console.log(s(2));// 是闭包
        // console.log(s(2));
        // console.log(s(2));
        // console.log(s(2));
        // console.log(s);// 不是闭包

    </script>
</body>
</html>